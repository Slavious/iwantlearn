<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ RPG</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container py-5">
        <div class="game-box text-center">
            <img id="dragon" src="images/dragon-baby.png" alt="–î—Ä–∞–∫–æ–Ω" class="dragon">
            <h2>üåü –ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ RPG</h2>
            <div id="levelInfo" class="mb-2"></div>
            <div class="progress mb-3">
                <div id="xpBar" class="progress-bar bg-success" role="progressbar" style="width: 0%;">0%</div>
            </div>
            <div id="message"></div>
            <div id="question" class="fs-4 mb-3"></div>
            <form id="answerForm" class="d-grid gap-2">
                <input type="number" name="answer" class="form-control" required autofocus>
                <button type="submit" class="btn btn-primary">–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏</button>
            </form>
        </div>
    </div>

    <script>
        function updateGame(data) {
            document.getElementById('dragon').src = 'images/' + data.avatar;
            document.getElementById('levelInfo').innerHTML = `<strong>–†—ñ–≤–µ–Ω—å:</strong> ${data.level} | <strong>XP:</strong> ${data.xp}/50`;
            document.getElementById('xpBar').style.width = `${data.xp_percent}%`;
            document.getElementById('xpBar').innerText = `${Math.round(data.xp_percent)}%`;
            document.getElementById('question').innerText = data.question + ' = ?';
            const inputField = document.querySelector('input[name=answer]');
            inputField.value = '';
            inputField.focus();

            const message = document.getElementById('message');
            message.innerHTML = data.message;
            message.className = data.flash ? 'flash' : '';

            if (data.flash) {
                launchConfetti();
            }

            if (data.victory) {
                document.body.innerHTML = `
                    <div class="container py-5">
                        <div class="game-box text-center">
                            <img src="images/${data.avatar}" alt="–ü–µ—Ä–µ–º–æ–∂–Ω–∏–π –¥—Ä–∞–∫–æ–Ω" class="dragon">
                            <h2 class="victory-banner">üèÜ –¢–∏ –¥–æ—Å—è–≥ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è!</h2>
                            <p class="fs-4 mb-4">–¢–≤—ñ–π —Ç–∏—Ç—É–ª: <strong>–ê—Ä—Ö—ñ-—Ä–∞—Ö—ñ–≤–Ω–∏–∫ –¥—Ä–∞–∫–æ–Ω—è—á–æ–≥–æ –æ—Ä–¥–µ–Ω—É</strong></p>
                            <p>–¢–∏ –∑–¥–æ–±—É–≤ –ø–æ—à–∞–Ω—É –≤—Å—ñ—Ö —á–∏—Å–µ–ª —ñ –∑–∞–ª–∏—à–∏–≤ —Å–ª—ñ–¥ —É –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ–º—É —Å–≤—ñ—Ç—ñ.</p>
                            <button onclick="restartGame()" class="btn btn-success mt-3">üîÅ –ü–æ—á–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ</button>
                        </div>
                    </div>`;
            }
        }

        function restartGame() {
            fetch('game.php', {
                method: 'POST',
                body: new URLSearchParams({ restart: true })
            }).then(() => location.reload());
        }

        function launchConfetti() {
            const container = document.getElementById('confettiContainer');
            container.innerHTML = ''; // –û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —á–∞—Å—Ç–∏–Ω–∫–∏

            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti-piece');

                // –ü–æ–∑–∏—Ü—ñ—è –ø–æ —à–∏—Ä–∏–Ω—ñ
                confetti.style.left = Math.random() * 100 + '%';
                // –í–∏–ø–∞–¥–∫–æ–≤–∏–π –∫–æ–ª—ñ—Ä
                confetti.style.backgroundColor = randomColor();
                // –í–∏–ø–∞–¥–∫–æ–≤–µ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
                confetti.style.animationDelay = (Math.random() * 0.5) + 's';
                // –í–∏–ø–∞–¥–∫–æ–≤–∏–π –Ω–∞—Ö–∏–ª
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;

                container.appendChild(confetti);
            }

            // –í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ–Ω—Ñ–µ—Ç—ñ –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
            setTimeout(() => container.innerHTML = '', 2500);
        }

        function randomColor() {
            const colors = ['#ff0', '#0f0', '#f00', '#0ff', '#f0f', '#00f', '#ffa500', '#00ffa5'];
            return colors[Math.floor(Math.random() * colors.length)];
        }


        document.getElementById('answerForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('game.php', { method: 'POST', body: formData })
                .then(res => res.json())
                .then(data => updateGame(data));
        });

        fetch('game.php')
            .then(res => res.json())
            .then(data => updateGame(data));
    </script>

    <div class="confetti" id="confettiContainer"></div>
</body>
</html>
